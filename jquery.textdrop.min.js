////////////////////////////////////////////////////////
////  Text Drop                                     ////
////  jQuery plugin by Otto Nascarella              ////
////  GPL 2 licence.                                ////
////                                                ////
////  Syntax:                                       ////
////  $(paragraph).textdrop({options},[callback]);  ////
////////////////////////////////////////////////////////

/*

Options can be:
{
   type: "word", // animate by word.
   duration: 2000,
   fontSize: 40, //start animation with font on this size
   easing: "easeBounceOut",
   delay: 3000 ///start animating after this delay
}

You are not allowed to have anything in the element other than letters and <br> elements.

*/
!function(t,e){"use strict";t.fn.textdrop=function(o,n){function i(t){m.stopped=!1,m.x=t.pageX,m.y=t.pageY}function s(t){t=t.originalEvent?t.originalEvent:t,"touchmove"===t.type&&t.preventDefault(),m.stopped=!1,m.x=t.touches[0].pageX,m.y=t.touches[0].pageY}var r,u,c,a,p,l,d,f,m;return o===e&&(o={}),p=document,l=p.body||t("body")[0],r=o.duration||1e3,u=o.delay||0,c=o.easing||"swing",a=o.fontSize||this.css("font-size"),d="ontouchstart"in window,f=this.length,m={},"number"==typeof o?r=o:"function"==typeof o&&(n=o),d?t(p).bind("touchmove.textdrop touchstart.textdrop",s):t(p).bind("mousemove.textdrop",i),"function"!=typeof p.contains&&(p.contains=function(t){for(;t;){if(t===document)return!0;t=t.parentNode}return!1}),this.each(function(){function l(){var o,n,i,s;if(k++,n=T[k],o=t(n).offset(),!p.contains(w[0])||o===e)return!1;if(!(k>=W.length)){if("\n"===W[k])return void l();if(X.size=w.css("font-size"),i=t(p.createElement("span")).addClass("flying").html(W[k]).css({position:"absolute",top:m.y,left:m.x,color:X.color,backgroundColor:X.bgcolor,fontFamily:X.family,fontSize:a,textShadow:X.textShadow,fontWeight:X.fontWeight,transform:"translateZ(0)"}).data("eq",n),s={top:o.top,left:o.left,fontSize:X.size},X.fontSize===a&&delete s.fontSize,i.appendTo(S),E.push(i),k===W.length-1){if(f--,0===f)return void i.animate(s,r,c,g);i.animate(s,r,c,h),m.stopped===!1&&(clearTimeout(C.letter),C.letter=setTimeout(l,200))}else i.animate(s,r,c),m.stopped===!1&&(clearTimeout(C.letter),C.letter=setTimeout(l,200))}}function h(){clearTimeout(C.letter),clearTimeout(C.mouse),clearTimeout(C.halt),d?(t(p).unbind("touchstart.textdrop",x),t(p).unbind("touchend.textdrop",y)):(t(p).unbind("mousemove.textdrop",l),t(p).unbind("mousemove.textdrop",b)),t(E).each(function(){this.stop(!0,!1),this.remove()}),w.empty().html(z).css("visibility","visible")}function g(){h(),t(p).unbind("mousemove.textdrop",i),t(p).unbind("touchstart.textdrop",s),t(p).unbind("touchmove.textdrop",s),"function"==typeof n&&n.apply(w[0])}function b(){clearTimeout(C.mouse),C.mouse=setTimeout(function(){clearTimeout(C.letter),m.stopped=!0,t(p).one("mousemove.textdrop",l)},100)}function x(){l()}function y(){m.stopped=!0,t(p).one("touchstart.textdrop",x)}var v,T,z,w=t(this),S=w.parent(),E=[],W=[],k=0,C={},X={};if(z=w.html(),o.type){if("word"===o.type){for(W=w.html().replace(/\n/g,"").replace(/<br(>|\/>|\s\/>)/gi," \n ").split(" "),k=W.length;k--;)W.splice(k,0," ");W.shift()}}else W=w.html().replace(/\n/g,"").replace(/<br(>|\/>|\s\/>)/gi,"\n").split("");for(C={mouse:0,letter:0,halt:0},X={size:w.css("font-size"),family:w.css("font-family"),color:w.css("color"),bgcolor:w.css("background-color"),textShadow:w.css("text-shadow"),fontWeight:w.css("font-weight")},m.stopped=!1,w.empty(),k=0;k<W.length;k++)v="\n"===W[k]?t(p.createElement("br")).appendTo(w):t(p.createElement("span")).html(W[k]).css("visibility","hidden").appendTo(w);k=-1,T=w.children(),C.mouse=d?setTimeout(function(){t(p).one("touchmove.textdrop touchstart.textdrop",x),t(p).bind("touchend.textdrop",y)},u):setTimeout(function(){t(p).bind("mousemove.textdrop",b),t(p).one("mousemove.textdrop",l)},u)}),this}}(jQuery);